{"version":3,"sources":["filter.js"],"names":["Filter","container","data","options","facets","map","facet","used","values","value","opts","tooltips","autoFocus","containerClicked","triggerCount","ENTER","TAB","ESC","DOWN","UP","makeFilter","focus","filter","document","createElement","className","filterKey","separator","textContent","filterKeyInput","setAttribute","addEventListener","handleKeyFocus","handleKeyBlur","handleKeyboard","filterVal","filterValInput","handleValBlur","closeBtn","event","removeFilter","target","appendChild","keys","key","header","makeAutoComplete","getKeyDiv","querySelector","getKeyInput","getValueDiv","getValueInput","getCloseButton","suppressEvent","getFilterEl","classList","includes","parentElement","filterEl","find","val","removeChild","getAllFilters","forEach","length","clearButton","dispatchEvent","Event","commitValue","valueEl","valInput","closeButton","Array","prototype","call","replace","remove","add","isTruncatedX","$","tooltip","title","preventKeyScroll","keyCode","preventDefault","handleMouseDown","handleMouseUp","handleClick","uncommitted","children","child","window","removeEventListener","relatedTarget","stopImmediatePropagation","handleUpDown","code","isOriginalEvent","next","selected","sc","childNodes","nextSibling","previousSibling","newEvent","KeyboardEvent","detail","activateTooltips","mutationsList","observer","mutation","type","addedNodes","selector","choices","autoComplete","menuClass","minChars","isArray","source","term","response","toLowerCase","matches","choice","renderItem","item","search","re","RegExp","split","join","itemEl","displayItem","innerHTML","outerHTML","onSelect","keyInput","keyEl","valChoices","noRepeat","MutationObserver","observe","childList","querySelectorAll","makeClearButton","result","filters","query","str","push"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2011-2018, Hortonworks Inc.  All rights reserved.\n * Except as expressly permitted in a written agreement between you\n * or your company and Hortonworks, Inc, any use, reproduction,\n * modification, redistribution, sharing, lending or other exploitation\n * of all or any part of the contents of this file is strictly prohibited.\n */\n\n/*\n  Based on \"JavaScript fancySearch\" created by P Kishor\n  GitHub: https://github.com/punkish/fancysearch\n*/\n\n'use strict';\n\nconst Filter = function (container, data, options) {\n  const facets = data.map(facet => ({\n    ...facet,\n    used: false,\n    values: facet.values ? facet.values.map(value => ({ value, used: false })) : []\n  }));\n\n  const opts = {\n    tooltips: true,\n    autoFocus: true,\n    ...options\n  };\n\n  let containerClicked = false; // Keeps track of when the container was clicked on, which affects how we handle blur events for the filters.\n  let triggerCount = 0; // Keeps track of how many times to re-trigger the keyDown even in handleUpDown().\n\n  const ENTER = 13;\n  const TAB = 9;\n  const ESC = 27;\n  const DOWN = 40;\n  const UP = 38;\n\n  // Creates the following HTML. This is the structure of a single filter inside the container.\n  // <div class=\"filter filter-key-empty\">\n  //   <div class=\"filter-key hide\"></div>\n  //   <div class=\"separator\">:</div>\n  //   <input class=\"filter-key-input\" readonly=\"true\"></input>\n  //   <div class=\"filter-val hide\"></div>\n  //   <input class=\"filter-val-input hide\"></input>\n  //   <button class=\"close hide\" type=\"button\" aria-label=\"Remove Filter\"></button>\n  // </div>\n  const makeFilter = focus => {\n    const filter = document.createElement('div');\n    filter.className = 'filter filter-key-empty';\n\n    const filterKey = document.createElement('div');\n    filterKey.className = 'filter-key hide';\n\n    const separator = document.createElement('div');\n    separator.className = 'separator';\n    separator.textContent = ':';\n\n    const filterKeyInput = document.createElement('input');\n    filterKeyInput.className = 'filter-key-input';\n    filterKeyInput.setAttribute('readonly', 'true');\n    filterKeyInput.addEventListener('focus', handleKeyFocus);\n    filterKeyInput.addEventListener('blur', handleKeyBlur);\n    filterKeyInput.addEventListener('keydown', handleKeyboard);\n\n    const filterVal = document.createElement('div');\n    filterVal.className = 'filter-val hide';\n\n    const filterValInput = document.createElement('input');\n    filterValInput.className = 'filter-val-input hide';\n    filterValInput.addEventListener('keydown', handleKeyboard);\n    filterValInput.addEventListener('blur', handleValBlur);\n\n    const closeBtn = document.createElement('button');\n    closeBtn.className = 'close hide';\n    closeBtn.setAttribute('type', 'button');\n    closeBtn.setAttribute('aria-label', 'Remove Filter');\n    closeBtn.addEventListener('click', event => removeFilter(event.target));\n\n    filter.appendChild(filterKey);\n    filter.appendChild(separator);\n    filter.appendChild(filterKeyInput);\n    filter.appendChild(filterVal);\n    filter.appendChild(filterValInput);\n    filter.appendChild(closeBtn);\n    container.appendChild(filter);\n\n    const keys = facets.filter(facet => !facet.used).map(facet => ({ key: facet.key, header: facet.header }));\n    makeAutoComplete('key', filterKeyInput, keys);\n\n    if (focus) {\n      filterKeyInput.focus();\n    }\n  };\n\n  const getKeyDiv      = filter => filter.querySelector('.filter-key');\n  const getKeyInput    = filter => filter.querySelector('.filter-key-input');\n  const getValueDiv    = filter => filter.querySelector('.filter-val');\n  const getValueInput  = filter => filter.querySelector('.filter-val-input');\n  const getCloseButton = filter => filter.querySelector('.close');\n\n  const removeFilter = (target, suppressEvent) => {\n    if (target) {\n      const getFilterEl = target => {\n        if ([...target.classList].includes('filter')) {\n          return target;\n        } else {\n          return getFilterEl(target.parentElement);\n        }\n      }\n\n      // Return filter key and value to unused state.\n      const filterEl = getFilterEl(target);\n      if (filterEl) {\n        const key = getKeyInput(filterEl).value;\n        if (key) {\n          const facet = facets.find(facet => facet.key === key);\n          if (facet) {\n            facet.used = false;\n\n            const val = getValueInput(filterEl).value;\n            if (val) {\n              const value = facet.values.find(value => value.value === val);\n              if (value) {\n                value.used = false;\n              }\n            }\n          }\n        }\n\n        // Remove filter element from UI.\n        // Check if it is still in the DOM (has a parent) first.\n        if (filterEl.parentElement) {\n          filterEl.parentElement.removeChild(filterEl);\n        }\n      }\n\n      // Remove uncommitted filters because the used items state may have changed\n      getAllFilters(':not(.filter-committed)').forEach(filter => filter.parentElement.removeChild(filter));\n\n      // Hide Clear All button if there are no more filters\n      if (getAllFilters().length === 0) {\n        clearButton.className = 'close hide';\n      }\n\n      // Emit event.\n      if (!suppressEvent) {\n        container.dispatchEvent(new Event('changed.fluid.filter'));\n      }\n\n      makeFilter();\n    }\n  };\n\n  const commitValue = filter => {\n    const valueEl = getValueDiv(filter);\n    const valInput = getValueInput(filter);\n    const closeButton = getCloseButton(filter);\n\n    if (valInput.value !== ''\n      && !Array.prototype.includes.call(filter.classList, 'filter-committed')) {\n      // 1. Commit the selected value in the UI.\n      filter.classList.replace('filter-val-empty', 'filter-committed');\n      valueEl.textContent = valInput.value;\n      valueEl.classList.remove('hide');\n      valInput.classList.add('hide');\n      closeButton.classList.remove('hide');\n      clearButton.classList.remove('hide'); // Show Clear All button\n\n      // 2. Mark the selected value as used.\n      const key = getKeyInput(filter).value;\n      const facet = facets.find(facet => facet.key === key);\n      if (facet) {\n        const value = facet.values.find(value => value.value === valInput.value);\n        if (value) {\n          value.used = true;\n        }\n      }\n\n      // 3. Add tooltip if needed.\n      if (opts.tooltips && isTruncatedX(valueEl)) {\n        $(valueEl).tooltip({\n          title: valInput.value\n        });\n      }\n\n      // 4. Emit event.\n      container.dispatchEvent(new Event('changed.fluid.filter'));\n\n      // 5. Make the next new filter.\n      makeFilter(opts.autoFocus);\n\n      return true;\n    }\n  };\n\n  const preventKeyScroll = event => {\n    switch (event.keyCode) {\n      case UP:\n      case DOWN:\n        event.preventDefault();\n        break;\n    }\n  };\n\n  const handleMouseDown = event => containerClicked = true;\n\n  const handleMouseUp = event => containerClicked = false;\n\n  const handleClick = event => {\n    const filter = event.target;\n    uncommitted = Array.prototype.find.call(filter.children, child => Array.prototype.includes.call(child.classList, 'filter') && !Array.prototype.includes.call(child.classList, 'filter-committed'));\n    if (uncommitted) {\n      getKeyInput(uncommitted).focus();\n    }\n  };\n\n  const handleKeyFocus = () => window.addEventListener('keydown', preventKeyScroll);\n\n  const handleKeyBlur = event => {\n    window.removeEventListener('keydown', preventKeyScroll);\n\n    // If the element is blurred because the container was clicked on\n    // and it is still in the uncommitted state, it will be immediately refocused.\n    // In that case, we do not allow the blur event to propagate\n    // because we want to keep the autocomplete menu visible.\n    // However, if a close button within the container was clicked, then\n    // event.relatedTarget will be populated, so we allow normal blurring behavior.\n    if (containerClicked && !event.relatedTarget && !Array.prototype.includes.call(event.target.classList, 'filter-committed')) {\n      event.stopImmediatePropagation();\n    }\n  };\n\n  const handleValBlur = event => commitValue(event.target.parentElement);\n\n  const handleUpDown = (code, target, isOriginalEvent) => {\n    let next;\n\n    const selected = target.sc.querySelector('.autocomplete-suggestion.selected');\n    if (!selected) {\n      next = (code === DOWN) ? target.sc.querySelector('.autocomplete-suggestion') : target.sc.childNodes[target.sc.childNodes.length - 1]; // first : last\n    } else {\n      next = (code === DOWN) ? selected.nextSibling : selected.previousSibling;\n    }\n\n    if (next && Array.prototype.includes.call(next.classList, 'autocomplete-header')) {\n      if (triggerCount === 0 && isOriginalEvent) {\n        while (next) {\n          if (Array.prototype.includes.call(next.classList, 'autocomplete-header')) {\n            triggerCount++;\n          } else {\n            break;\n          }\n\n          next = (code === DOWN) ? next.nextSibling : next.previousSibling;\n        }\n      }\n\n      if (triggerCount > 0) {\n        triggerCount--;\n        const newEvent = new KeyboardEvent('keydown', { keyCode: code, detail: true });\n        target.dispatchEvent(newEvent);\n      }\n    }\n  }\n\n  const handleKeyboard = event => {\n    switch (event.keyCode) {\n      case UP:\n      case DOWN:\n        handleUpDown(event.keyCode, event.target, !event.detail); // event.detail will be true if this is a re-triggered event from handleUpDown\n        break;\n      case ENTER:\n        commitValue(event.target.parentElement)\n        break;\n      case TAB:\n        if (!commitValue(event.target.parentElement)) {\n          clearButton.focus();\n        }\n        event.preventDefault();\n        break;\n      case ESC:\n        if (event.target.value === '') {\n          removeFilter(event.target);\n        }\n        break;\n    }\n  };\n\n  const activateTooltips = (mutationsList, observer) => {\n    for (let mutation of mutationsList) {\n      if (mutation.type === 'childList' && mutation.addedNodes) {\n        mutation.addedNodes.forEach(child => {\n          if (isTruncatedX(child)) {\n            $(child).tooltip({\n              title: child.textContent\n            });\n          }\n        });\n      }\n    }\n  }\n\n  const makeAutoComplete = (type, selector, choices) => {\n    new autoComplete({\n      selector: selector,\n      menuClass: 'dropdown-menu',\n      minChars: Array.isArray(choices) ? 0 : 3,\n      source: function (term, response) {\n        // The very first time this is called,\n        // when the control is constructed,\n        // choices will contain all keys.\n        term = term.toLowerCase();\n\n        let matches;\n        if (type === 'key') {\n          matches = choices.filter(choice => choice.key.toLowerCase().includes(term));\n        } else {\n          matches = choices.filter(choice => choice.toLowerCase().includes(term));\n        }\n\n        response(matches);\n      },\n      renderItem: function (item, search) {\n        search = search.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n        const re = new RegExp(\"(\" + search.split(' ').join('|') + \")\", \"gi\");\n\n        let itemEl = document.createElement('div');\n        itemEl.className = 'autocomplete-suggestion dropdown-item';\n        if (type === 'key') {\n          // The items to render for keys do not include the data-val property.\n          // This prevents the control from being in an undefined state if the user\n          // traverses the values in the dropdown using the arrow keys.\n          if (item.header) {\n            itemEl.classList.add('autocomplete-header');\n          }\n          itemEl.textContent = item.key;\n        } else {\n          itemEl.setAttribute('data-val', item);\n          const displayItem = item.replace(re, '<b>$1</b>');\n          itemEl.innerHTML = displayItem;\n        }\n\n        // Add tooltip if needed.\n        // if (opts.tooltips) {\n        //   itemEl.setAttribute('data-toggle', 'tooltip');\n        //   itemEl.setAttribute('data-placement', 'right');\n        //   itemEl.setAttribute('data-condition', 'truncated');\n        //   itemEl.setAttribute('title', itemEl.textContent);\n        // }\n\n        return itemEl.outerHTML;\n      },\n      onSelect: function (event, term, item) {\n        if (Array.prototype.includes.call(item.classList, 'autocomplete-header')) {\n          event.stopImmediatePropagation();\n        } else {\n          term = item.textContent;\n          const keyInput = this.selector;\n          const filterEl = keyInput.parentElement;\n\n          if (type === 'key') {\n            // A key was just selected:\n            // 1. Commit the selected key in the UI.\n            const keyEl = getKeyDiv(filterEl);\n            keyInput.classList.add('hide');\n            keyInput.value = term;\n            keyEl.textContent = term;\n            keyEl.classList.remove('hide');\n            filterEl.classList.replace('filter-key-empty', 'filter-val-empty');\n\n            // 2. Add tooltip if needed.\n            if (opts.tooltips && isTruncatedX(keyEl)) {\n              $(keyEl).tooltip({\n                title: keyEl.textContent\n              });\n            }\n\n            // 3. Determine choices for next autocomplete, which should\n            //    contain the available values for the selected key.\n            let valChoices = [];\n\n            const facet = facets.find(facet => facet.key === term);\n            if (facet) {\n              // We found the selected key, so filter its values to get the ones not yet used.\n              valChoices = facet.values.filter(val => !val.used).map(val => val.value);\n\n              // If the key is not reusable, mark it as used.\n              if (facet.noRepeat) {\n                facet.used = true;\n              }\n            }\n\n            // 4. Create the autocomplete for the key's values using the available choices.\n            const valInput = getValueInput(filterEl);\n            makeAutoComplete('val', valInput, valChoices);\n\n            // 5. Activate the value input for the filter.\n            valInput.classList.remove('hide');\n            valInput.focus();\n          } else {\n            // A value was just selected\n            commitValue(filterEl);\n          }\n        }\n      }\n    });\n\n    if (opts.tooltips && selector.sc) {\n      const observer = new MutationObserver(activateTooltips);\n      observer.observe(selector.sc, { childList: true });\n    }\n  };\n\n  const getAllFilters = selector => [...container.querySelectorAll(`.filter${selector || ''}`)];\n\n  const makeClearButton = () => {\n    const clearButton = document.createElement('button');\n    clearButton.className = 'close hide clearAllFilters';\n    clearButton.setAttribute('type', 'button');\n    clearButton.setAttribute('aria-label', 'Clear All Filters');\n    clearButton.addEventListener('click', () => getAllFilters().forEach(filter => removeFilter(filter, false)));\n    container.dispatchEvent(new Event('changed.fluid.filter'));\n    return clearButton;\n  };\n\n  const clearButton = makeClearButton();\n  container.appendChild(clearButton);\n  container.addEventListener('mousedown', handleMouseDown);\n  container.addEventListener('click', handleClick);\n  container.addEventListener('mouseup', handleMouseUp);\n\n  makeFilter();\n\n  this.result = () => {\n    const filters = getAllFilters();\n    const query = {};\n\n    filters.forEach(filter => {\n      const key = getKeyInput(filter).value.toLowerCase();\n      const val = getValueInput(filter).value;\n\n      if (key && val) {\n        if (key in query) {\n          if (typeof (query[key]) === 'string') {\n            // This is the second entry of a multi-valued filter,\n            // so turn the single string into an array.\n            const str = query[key];\n            query[key] = [str, val]\n          } else {\n            query[key].push(val);\n          }\n        } else {\n          query[key] = val;\n        }\n      }\n    });\n\n    return query;\n  };\n};\n"],"file":"filter.js"}